<% provide(:title, 'Network') %>
<head>
  <link rel="stylesheet" type="text/css" href="/css/forced-network.css" media="all">
  <style type="text/css">
    body {
      padding-top: 50px;
    }
    .starter-template {
      padding: 40px 15px;
      text-align: center;
    }

    .modal-backdrop.fade.in {
      opacity: 0.5;
      filter: alpha(opacity=50);
    }
  </style>
</head>

<div class="container">
  <ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li class="active">Data</li>
  </ol>

  <div class="row">
    <div class="col-md-6">
      <h1>Network Table</h1>
      <table class="table table-hover">
        <thead>
            <tr>
              <th>Name</th>
              <th>Interface</th>
              <th>Stage</th>
            </tr>
          </thead>
          <tbody>
            <% @instance_status.each do |instance| %>
              <tr onclick="generateInstance('<%= instance['id'] %>')">
                <td><%= instance['name'] %></td>
                <td><%= instance['interfaces'] %></td>
                <% if instance['stage'] == 'undefined' %>
                  <td><span class="label label-danger"><%= instance['stage'] %></span></td>
                <% elsif instance['stage'] == 'deploy' %>
                  <td><span class="label label-success"><%= instance['stage'] %></span></td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
      </table>
      <div id="instanceInfo"></div>
      <div id="importExportInfo"></div>
    </div>
    <div class="col-md-6">
      <h1>Network Graph</h1>
      <div id="forceGraph"></div>
    </div>
  </div><br/>

</div>

<script src="http://d3js.org/d3.v2.js?2.9.1"></script>
<script src="/js/forced-graph.js"></script>

<script>
/* TODO:
   Access instance data structure
   and get id from hash, display
   modal view of specific instance data
*/

  function generateInstance(id) {
    // console.log("id of instance: " + id);

    $.getJSON("/ancor-api-sample/instances/"+id+".json", function(result) {
      var instanceData = "<table class=\"table table-striped\"><thead><tr><th>Data</th><th>Value</th></tr></thead><tbody>",
          importExportData = "",
          instanceName = "";

      for (var obj in result) {
        if (obj == "imports"
         || obj == "exports") {

          console.log(obj + ": ");
          importExportData += "<h2>" + obj + "</h2>";
          importExportData += "<table class=\"table table-striped\"><thead><tr><th>Data</th><th>Value</th></tr></thead><tbody>";
          for (var elem in result[obj]) {
            for (var v in result[obj][elem]) {
              console.log("-->" + v + ": " + result[obj][elem][v]);
              importExportData += "<tr><td>" + v + "</td>";
              importExportData += "<td>" + result[obj][elem][v] + "</td></tr>";
            }
          }
          importExportData += "</tbody></table></br>";
        }
        else {
          if (obj == 'name') {
            instanceName = "<h2>" + result[obj] + "</h2>";
          }

          console.log(obj + ": " + result[obj]);
          instanceData += "<tr><td>" + obj + "</td>";
          instanceData += "<td>" + result[obj] + "</td></tr>";
        }
      }
      instanceData += "</tbody></table>";
      $('#instanceInfo')[0].innerHTML = instanceName + instanceData;
      $('#importExportInfo')[0].innerHTML = importExportData;
    });
  }

  function getInstances() {
    $.getJSON("/ancor-api-sample/instances.json", function(result) {
        for (var obj in result) {
          for (var id in result[obj]) {
            if (id == "id") {
              console.log(result[obj][id]);
            }
          }
        }
    });
  }
</script>
